## **Code 7.4**

PB21010452 肖羿

### **1.目标**

使用 Matlab 实现龙贝格算法，分别计算积分 $I_1=\int_0^1\frac{\sin x}{x}\ dx$、$I_2=\int_{-1}^{1}\frac{\cos x-e^x}{\sin x}\ dx$、$I_3=\int_1^{\infty}\frac{1}{xe^x}\ dx$ 并打印龙贝格阵列，计算误差 $error=|I-R(m,m)|,m=1,2,3...,7$ 。

### **2.算法**

$R(n,m)=\begin{cases}\frac{b-a}{2}(f(a)+f(b)),n=0,m=0\\\frac{R(n-1,0)}{2}+h_n\sum\limits_{i=1}^{2^{n-1}}f(a+(2i-1)h_n),n\neq 0,m=0\\R(n,m-1)+\frac{R(n,m-1)-R(n-1,m-1)}{4^m-1},n\neq 0,m\neq 0\end{cases}$

其中 $h_n=\frac{b-a}{2^{n}}$ 。

计算 $f(x)$ 时均向附近偏移 $eps=10^{-20}$ 以避开间断点。

对于积分三：$I_3=\int_1^{\infty}\frac{1}{xe^x}\ dx=\int_0^1\frac{1}{xe^{\frac{1}{x}}}\ dx$。

### **3.结果**

#### **(1).【Romberg 阵列】**

|积分一|$m=0$|$m=1$|$m=2$|$m=3$|$m=4$|$m=5$|$m=6$|$m=7$|
| :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: |
| $n=0$ | 0.920735  ||||||||
| $n=1$ | 0.939793  | 0.946146  |||||||
| $n=2$ | 0.944514  | 0.946087  | 0.946083  ||||||
| $n=3$ | 0.945691  | 0.946083  | 0.946083  | 0.946083  |||||
| $n=4$ | 0.945985  | 0.946083  | 0.946083  | 0.946083  | 0.946083  ||||
| $n=5$ | 0.946059  | 0.946083  | 0.946083  | 0.946083  | 0.946083  | 0.946083  |||
| $n=6$ | 0.946077  | 0.946083  | 0.946083  | 0.946083  | 0.946083  | 0.946083  | 0.946083  ||
| $n=7$ | 0.946082  | 0.946083  | 0.946083  | 0.946083  | 0.946083  | 0.946083  | 0.946083  | 0.946083  |

|积分二|$m=0$|$m=1$|$m=2$|$m=3$|$m=4$|$m=5$|$m=6$|$m=7$|
| :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: |
| $n=0$ | -2.793207  ||||||||
| $n=1$ | -1.396603  | -0.931069  |||||||
| $n=2$ | -1.785218  | -1.914756  | -1.980335  ||||||
| $n=3$ | -2.006326  | -2.080029  | -2.091047  | -2.092804  |||||
| $n=4$ | -2.124030  | -2.163265  | -2.168814  | -2.170049  | -2.170351  ||||
| $n=5$ | -2.184702  | -2.204925  | -2.207703  | -2.208320  | -2.208470  | -2.208507  |||
| $n=6$ | -2.215494  | -2.225758  | -2.227147  | -2.227456  | -2.227531  | -2.227550  | -2.227554  ||
| $n=7$ | -2.231005  | -2.236175  | -2.236869  | -2.237024  | -2.237061  | -2.237071  | -2.237073  | -2.237074  |

|积分三|$m=0$|$m=1$|$m=2$|$m=3$|$m=4$|$m=5$|$m=6$|$m=7$|
| :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: |
| $n=0$ | 0.183940  ||||||||
| $n=1$ | 0.227305  | 0.241760  |||||||
| $n=2$ | 0.219834  | 0.217344  | 0.215716  ||||||
| $n=3$ | 0.219351  | 0.219190  | 0.219313  | 0.219370  |||||
| $n=4$ | 0.219384  | 0.219394  | 0.219408  | 0.219410  | 0.219410 ||||
| $n=5$ | 0.219384  | 0.219384  | 0.219383  | 0.219383  | 0.219383  | 0.219383  |||
| $n=6$ | 0.219384  | 0.219384  | 0.219384  | 0.219384  | 0.219384  | 0.219384  | 0.219384  ||
| $n=7$ | 0.219384  | 0.219384  | 0.219384  | 0.219384  | 0.219384  | 0.219384  | 0.219384  | 0.219384  |

#### **(2).【误差】**

|      |   积分一    |   积分二   |   积分三    |
| :------: | :---------: | :--------: | :---------: |
| $R(1,1)$ | 6.28119e-05 |  1.31552   |  0.0223764  |
| $R(2,2)$ | 6.63035e-08 |  0.266257  |  0.0036682  |
| $R(3,3)$ | 2.00397e-11 |  0.153788  | 1.37675e-05 |
| $R(4,4)$ | 1.33227e-15 | 0.0762403  | 2.58144e-05 |
| $R(5,5)$ | 2.22045e-16 | 0.0380843  | 1.10127e-06 |
| $R(6,6)$ | 1.11022e-16 | 0.0190375  | 7.03128e-09 |
| $R(7,7)$ | 1.11022e-16 | 0.00951816 | 9.85519e-11 |

### **4.代码**

```python
fprintf("I1(f):\n");calc(@(x) sin(x)./x,0,1);
fprintf("I2(f):\n");calc(@(x) (cos(x)-exp(x))./sin(x),-1,1);
fprintf("I3(f):\n");calc(@(x) 1./(x.*exp(1./x)),0,1);

function calc(f,a,b)
M=7;int_f=integral(f,a,b);
fprintf("精确值: %.8f\n",int_f);
R=Romberg(f,a,b,M,1e-20);
fprintf("Romberg阵列:\n");
for n=0:M
    for m=0:n
        fprintf("%.8f ",R(n+1,m+1));
    end
    fprintf("\n");
end
fprintf("误差：\n");
for m=1:M
    fprintf("N=%d: error=%g\n",m,abs(R(m+1,m+1)-int_f));
end
fprintf("\n");
end

function R=Romberg(f,a,b,M,eps)
h=b-a;R=zeros(M+1,M+1);
%syms px;
%lim_a=limit(f(px),px,a);
R(1,1)=h/2*[f(a+eps)+f(b-eps)];%每个点向附近偏移eps后进行计算
mi=1;
for n=1:M
    h=h/2;
    R(n+1,1)=R(n,1)/2;
    for i=1:mi
        %calc_f=f(a+(2*i-1)*h);
        %calc_f=limit(f(px),px,a+(2*i-1)*h);
        calc_f=f(a+(2*i-1)*h+eps);
        R(n+1,1)=R(n+1,1)+h*calc_f;
    end
    p=1;
    for m=1:n
        p=p*4;
        R(n+1,m+1)=R(n+1,m)+(R(n+1,m)-R(n,m))/(p-1); 
    end
    mi=mi*2;
end
end

```